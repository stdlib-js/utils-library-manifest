/// <reference types="./index.d.ts" />
import e from"debug";import r from"resolve";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/fs-resolve-parent-path@esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-convert-path@esm/index.mjs";function i(e){if(e.__esModule)return e;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var t=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,t.get?t:{enumerable:!0,get:function(){return e[n]}})})),r}function o(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function s(e,r){for(var n=0,t=e.length-1;t>=0;t--){var i=e[t];"."===i?e.splice(t,1):".."===i?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(r)for(;n--;n)e.unshift("..");return e}var a=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,l=function(e){return a.exec(e).slice(1)};function f(){for(var e="",r=!1,n=arguments.length-1;n>=-1&&!r;n--){var t=n>=0?arguments[n]:"/";if("string"!=typeof t)throw new TypeError("Arguments to path.resolve must be strings");t&&(e=t+"/"+e,r="/"===t.charAt(0))}return(r?"/":"")+(e=s(b(e.split("/"),(function(e){return!!e})),!r).join("/"))||"."}function u(e){var r=c(e),n="/"===y(e,-1);return(e=s(b(e.split("/"),(function(e){return!!e})),!r).join("/"))||r||(e="."),e&&n&&(e+="/"),(r?"/":"")+e}function c(e){return"/"===e.charAt(0)}function p(){var e=Array.prototype.slice.call(arguments,0);return u(b(e,(function(e,r){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function d(e,r){function n(e){for(var r=0;r<e.length&&""===e[r];r++);for(var n=e.length-1;n>=0&&""===e[n];n--);return r>n?[]:e.slice(r,n-r+1)}e=f(e).substr(1),r=f(r).substr(1);for(var t=n(e.split("/")),i=n(r.split("/")),o=Math.min(t.length,i.length),s=o,a=0;a<o;a++)if(t[a]!==i[a]){s=a;break}var l=[];for(a=s;a<t.length;a++)l.push("..");return(l=l.concat(i.slice(s))).join("/")}function g(e){var r=l(e),n=r[0],t=r[1];return n||t?(t&&(t=t.substr(0,t.length-1)),n+t):"."}function h(e,r){var n=l(e)[2];return r&&n.substr(-1*r.length)===r&&(n=n.substr(0,n.length-r.length)),n}function m(e){return l(e)[3]}var v={extname:m,basename:h,dirname:g,sep:"/",delimiter:":",relative:d,join:p,isAbsolute:c,normalize:u,resolve:f};function b(e,r){if(e.filter)return e.filter(r);for(var n=[],t=0;t<e.length;t++)r(e[t],t,e)&&n.push(e[t]);return n}var y="b"==="ab".substr(-1)?function(e,r,n){return e.substr(r,n)}:function(e,r,n){return r<0&&(r=e.length+r),e.substr(r,n)},w=i(Object.freeze({__proto__:null,resolve:f,normalize:u,isAbsolute:c,join:p,relative:d,sep:"/",delimiter:":",dirname:g,basename:h,extname:m,default:v})),j="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function O(){throw new Error("setTimeout has not been defined")}function T(){throw new Error("clearTimeout has not been defined")}var N=O,S=T;function E(e){if(N===setTimeout)return setTimeout(e,0);if((N===O||!N)&&setTimeout)return N=setTimeout,setTimeout(e,0);try{return N(e,0)}catch(r){try{return N.call(null,e,0)}catch(r){return N.call(this,e,0)}}}"function"==typeof j.setTimeout&&(N=setTimeout),"function"==typeof j.clearTimeout&&(S=clearTimeout);var J,k=[],A=!1,_=-1;function M(){A&&J&&(A=!1,J.length?k=J.concat(k):_=-1,k.length&&x())}function x(){if(!A){var e=E(M);A=!0;for(var r=k.length;r;){for(J=k,k=[];++_<r;)J&&J[_].run();_=-1,r=k.length}J=null,A=!1,function(e){if(S===clearTimeout)return clearTimeout(e);if((S===T||!S)&&clearTimeout)return S=clearTimeout,clearTimeout(e);try{S(e)}catch(r){try{return S.call(null,e)}catch(r){return S.call(this,e)}}}(e)}}function D(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)r[n-1]=arguments[n];k.push(new P(e,r)),1!==k.length||A||E(x)}function P(e,r){this.fun=e,this.array=r}P.prototype.run=function(){this.fun.apply(null,this.array)};var R={},L=[],z={},q={},C={};function V(){}var F=V,G=V,U=V,$=V,B=V,H=V,I=V;function K(e){throw new Error("process.binding is not supported")}function Q(){return"/"}function W(e){throw new Error("process.chdir is not supported")}function X(){return 0}var Y=j.performance||{},Z=Y.now||Y.mozNow||Y.msNow||Y.oNow||Y.webkitNow||function(){return(new Date).getTime()};function ee(e){var r=.001*Z.call(Y),n=Math.floor(r),t=Math.floor(r%1*1e9);return e&&(n-=e[0],(t-=e[1])<0&&(n--,t+=1e9)),[n,t]}var re=new Date;function ne(){return(new Date-re)/1e3}var te={nextTick:D,title:"browser",browser:true,env:R,argv:L,version:"",versions:z,on:F,addListener:G,once:U,off:$,removeListener:B,removeAllListeners:H,emit:I,binding:K,cwd:Q,chdir:W,umask:X,hrtime:ee,platform:"browser",release:q,config:C,uptime:ne},ie=i(Object.freeze({__proto__:null,addListener:G,argv:L,binding:K,browser:true,chdir:W,config:C,cwd:Q,default:te,emit:I,env:R,hrtime:ee,nextTick:D,off:$,on:F,once:U,platform:"browser",release:q,removeAllListeners:H,removeListener:B,title:"browser",umask:X,uptime:ne,version:"",versions:z}));var oe=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},se=Object.keys;var ae=function(e){var r,n;for(r={},n=0;n<e.length;n++)r[e[n]]=!0;return se(r)},le=oe,fe=Object.prototype.hasOwnProperty;var ue=function(e,r){return le(r)?fe.call(r,"basedir")&&(e.basedir=r.basedir,"string"!=typeof e.basedir)?new TypeError("invalid option. `basedir` option must be a primitive string. Option: `"+e.basedir+"`."):fe.call(r,"paths")&&(e.paths=r.paths,"string"!=typeof e.paths)?new TypeError("invalid option. `paths` option must be a primitive string. Option: `"+e.paths+"`."):null:new TypeError("invalid argument. Options argument must be an object. Value: `"+r+"`.")},ce={filename:"manifest.json",basedir:"",paths:""},pe=w,de=ie.cwd,ge=e,he=r.sync,me=n.sync,ve=t,be=oe,ye=ae,we=ue,je=ce,Oe=ge("library-manifest:main"),Te=Object.prototype.hasOwnProperty,Ne=Object.keys;var Se=function e(r,n,t){var i,s,a,l,f,u,c,p,d,g,h,m,v,b,y,w;if("string"!=typeof r)throw new TypeError("invalid argument. First argument must be a string. Value: `"+r+"`.");if(u=JSON.parse(JSON.stringify(je)),arguments.length>2){if(h=we(u,t))throw h;u.basedir=pe.resolve(de(),u.basedir)}else u.basedir=de();if(Oe("Options: %s",JSON.stringify(u)),r=pe.resolve(u.basedir,r),m=pe.dirname(r),Oe("Manifest file path: %s",r),f=o(r),f=JSON.parse(JSON.stringify(f)),Oe("Manifest: %s",JSON.stringify(f)),!be(n))throw new TypeError("invalid argument. Second argument must be an object. Value: `"+n+"`.");for(Oe("Provided conditions: %s",JSON.stringify(n)),i=Ne(f.options),b=0;b<i.length;b++)d=i[b],Te.call(n,d)&&(f.options[d]=n[d]);for(Oe("Conditions for matching a configuration: %s",JSON.stringify(f.options)),Oe("Resolving matching configuration."),b=0;b<f.confs.length;b++){for(v=f.confs[b],y=0;y<i.length&&(d=i[y],Te.call(v,d)&&v[d]===f.options[d]);y++);if(y===i.length){p=JSON.parse(JSON.stringify(v)),Oe("Matching configuration: %s",JSON.stringify(p));break}}if(void 0===p)return Oe("Unable to resolve a matching configuration."),{};for(b=0;b<f.fields.length;b++)if(d=f.fields[b].field,Te.call(p,d)&&(v=p[d],f.fields[b].resolve))for(y=0;y<v.length;y++)v[y]=pe.resolve(m,v[y]);for(c=p.dependencies,Oe("Resolving %d dependencies.",c.length),a={basedir:u.basedir},b=0;b<c.length;b++){for(Oe("Resolving dependency: %s",c[b]),s=he(c[b],a),Oe("Dependency entry point: %s",s),s=me("package.json",{dir:pe.dirname(s)}),s=pe.dirname(s),Oe("Dependency path: %s",s),l={basedir:s},v=e(pe.join(s,u.filename),n,l),Oe("Dependency manifest: %s",JSON.stringify(v)),Oe("Merging dependency manifest."),y=0;y<f.fields.length;y++)if(d=f.fields[y].field,Te.call(v,d)){if(g=v[d],f.fields[y].resolve)for(w=0;w<g.length;w++)g[w]=pe.resolve(s,g[w]);p[d]=p[d].concat(g)}Oe("Resolved dependency: %s",c[b])}for(Oe("Removing duplicate entries."),b=0;b<f.fields.length;b++)d=f.fields[b].field,Te.call(p,d)&&(p[d]=ye(p[d]));for(Oe("Generating relative paths."),b=0;b<f.fields.length;b++)if(d=f.fields[b].field,Te.call(p,d)&&f.fields[b].resolve&&f.fields[b].relative)for(g=p[d],y=0;y<g.length;y++)g[y]=pe.relative(m,g[y]);if(u.paths)for(Oe("Converting paths to specified convention."),b=0;b<f.fields.length;b++)if(d=f.fields[b].field,Te.call(p,d))for(g=p[d],y=0;y<g.length;y++)g[y]=ve(g[y],u.paths);return Oe("Final configuration: %s",JSON.stringify(p)),p},Ee=Se;export{Ee as default};
//# sourceMappingURL=index.mjs.map
