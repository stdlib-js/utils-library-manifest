// Copyright (c) 2022 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/fs-resolve-parent-path@esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-convert-path@esm/index.mjs";function n(e){if(e.__esModule)return e;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var t=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,t.get?t:{enumerable:!0,get:function(){return e[n]}})})),r}function t(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function i(e,r){for(var n=0,t=e.length-1;t>=0;t--){var i=e[t];"."===i?e.splice(t,1):".."===i?(e.splice(t,1),n++):n&&(e.splice(t,1),n--)}if(r)for(;n--;n)e.unshift("..");return e}var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,a=function(e){return o.exec(e).slice(1)};function l(){for(var e="",r=!1,n=arguments.length-1;n>=-1&&!r;n--){var t=n>=0?arguments[n]:"/";if("string"!=typeof t)throw new TypeError("Arguments to path.resolve must be strings");t&&(e=t+"/"+e,r="/"===t.charAt(0))}return(r?"/":"")+(e=i(g(e.split("/"),(function(e){return!!e})),!r).join("/"))||"."}function u(e){var r=s(e),n="/"===m(e,-1);return(e=i(g(e.split("/"),(function(e){return!!e})),!r).join("/"))||r||(e="."),e&&n&&(e+="/"),(r?"/":"")+e}function s(e){return"/"===e.charAt(0)}function f(){var e=Array.prototype.slice.call(arguments,0);return u(g(e,(function(e,r){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function c(e,r){function n(e){for(var r=0;r<e.length&&""===e[r];r++);for(var n=e.length-1;n>=0&&""===e[n];n--);return r>n?[]:e.slice(r,n-r+1)}e=l(e).substr(1),r=l(r).substr(1);for(var t=n(e.split("/")),i=n(r.split("/")),o=Math.min(t.length,i.length),a=o,u=0;u<o;u++)if(t[u]!==i[u]){a=u;break}var s=[];for(u=a;u<t.length;u++)s.push("..");return(s=s.concat(i.slice(a))).join("/")}function d(e){var r=a(e),n=r[0],t=r[1];return n||t?(t&&(t=t.substr(0,t.length-1)),n+t):"."}function p(e,r){var n=a(e)[2];return r&&n.substr(-1*r.length)===r&&(n=n.substr(0,n.length-r.length)),n}function v(e){return a(e)[3]}var h={extname:v,basename:p,dirname:d,sep:"/",delimiter:":",relative:c,join:f,isAbsolute:s,normalize:u,resolve:l};function g(e,r){if(e.filter)return e.filter(r);for(var n=[],t=0;t<e.length;t++)r(e[t],t,e)&&n.push(e[t]);return n}var m="b"==="ab".substr(-1)?function(e,r,n){return e.substr(r,n)}:function(e,r,n){return r<0&&(r=e.length+r),e.substr(r,n)},y=n(Object.freeze({__proto__:null,resolve:l,normalize:u,isAbsolute:s,join:f,relative:c,sep:"/",delimiter:":",dirname:d,basename:p,extname:v,default:h})),b="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function w(){throw new Error("setTimeout has not been defined")}function j(){throw new Error("clearTimeout has not been defined")}var O=w,T=j;function _(e){if(O===setTimeout)return setTimeout(e,0);if((O===w||!O)&&setTimeout)return O=setTimeout,setTimeout(e,0);try{return O(e,0)}catch(r){try{return O.call(null,e,0)}catch(r){return O.call(this,e,0)}}}"function"==typeof b.setTimeout&&(O=setTimeout),"function"==typeof b.clearTimeout&&(T=clearTimeout);var N,k=[],E=!1,F=-1;function S(){E&&N&&(E=!1,N.length?k=N.concat(k):F=-1,k.length&&x())}function x(){if(!E){var e=_(S);E=!0;for(var r=k.length;r;){for(N=k,k=[];++F<r;)N&&N[F].run();F=-1,r=k.length}N=null,E=!1,function(e){if(T===clearTimeout)return clearTimeout(e);if((T===j||!T)&&clearTimeout)return T=clearTimeout,clearTimeout(e);try{T(e)}catch(r){try{return T.call(null,e)}catch(r){return T.call(this,e)}}}(e)}}function q(e){var r=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)r[n-1]=arguments[n];k.push(new D(e,r)),1!==k.length||E||_(x)}function D(e,r){this.fun=e,this.array=r}D.prototype.run=function(){this.fun.apply(null,this.array)};var A={},I=[],P={},M={},J={};function z(){}var C=z,L=z,R=z,U=z,$=z,V=z,G=z;function K(e){throw new Error("process.binding is not supported")}function Z(){return"/"}function B(e){throw new Error("process.chdir is not supported")}function H(){return 0}var Q=b.performance||{},W=Q.now||Q.mozNow||Q.msNow||Q.oNow||Q.webkitNow||function(){return(new Date).getTime()};function X(e){var r=.001*W.call(Q),n=Math.floor(r),t=Math.floor(r%1*1e9);return e&&(n-=e[0],(t-=e[1])<0&&(n--,t+=1e9)),[n,t]}var Y=new Date;function ee(){return(new Date-Y)/1e3}var re={nextTick:q,title:"browser",browser:true,env:A,argv:I,version:"",versions:P,on:C,addListener:L,once:R,off:U,removeListener:$,removeAllListeners:V,emit:G,binding:K,cwd:Z,chdir:B,umask:H,hrtime:X,platform:"browser",release:M,config:J,uptime:ee},ne=n(Object.freeze({__proto__:null,addListener:L,argv:I,binding:K,browser:true,chdir:B,config:J,cwd:Z,default:re,emit:G,env:A,hrtime:X,nextTick:q,off:U,on:C,once:R,platform:"browser",release:M,removeAllListeners:V,removeListener:$,title:"browser",umask:H,uptime:ee,version:"",versions:P}));void 0!==re&&"renderer"===re.type?module.exports=require("./browser.js"):module.exports=require("./node.js");var te=n(Object.freeze({__proto__:null})),ie=require("fs"),oe=require("./homedir"),ae=require("path"),le=require("./caller"),ue=require("./node-modules-paths"),se=require("./normalize-options"),fe=require("is-core-module"),ce=ie.realpath&&"function"==typeof ie.realpath.native?ie.realpath.native:ie.realpath,de=oe(),pe=function(e,r){ie.stat(e,(function(e,n){return e?"ENOENT"===e.code||"ENOTDIR"===e.code?r(null,!1):r(e):r(null,n.isFile()||n.isFIFO())}))},ve=function(e,r){ie.stat(e,(function(e,n){return e?"ENOENT"===e.code||"ENOTDIR"===e.code?r(null,!1):r(e):r(null,n.isDirectory())}))},he=function(e,r){ce(e,(function(n,t){n&&"ENOENT"!==n.code?r(n):r(null,n?e:t)}))},ge=function(e,r,n,t){n&&!1===n.preserveSymlinks?e(r,t):t(null,r)},me=function(e,r,n){e(r,(function(e,r){if(e)n(e);else try{var t=JSON.parse(r);n(null,t)}catch(e){n(null)}}))};module.exports=function(e,r,n){var t=n,i=r;if("function"==typeof r&&(t=i,i={}),"string"!=typeof e){var o=new TypeError("Path must be a string.");return re.nextTick((function(){t(o)}))}var a=(i=se(e,i)).isFile||pe,l=i.isDirectory||ve,u=i.readFile||ie.readFile,s=i.realpath||he,f=i.readPackage||me;if(i.readFile&&i.readPackage){var c=new TypeError("`readFile` and `readPackage` are mutually exclusive.");return re.nextTick((function(){t(c)}))}var d=i.packageIterator,p=i.extensions||[".js"],v=!1!==i.includeCoreModules,h=i.basedir||ae.dirname(le()),g=i.filename||h;i.paths=i.paths||[ae.join(de,".node_modules"),ae.join(de,".node_libraries")];var m,y=ae.resolve(h);function b(r,n,o){r?t(r):n?t(null,n,o):O(m,(function(r,n,o){if(r)t(r);else if(n)ge(s,n,i,(function(e,r){e?t(e):t(null,r,o)}));else{var a=new Error("Cannot find module '"+e+"' from '"+g+"'");a.code="MODULE_NOT_FOUND",t(a)}}))}function w(e,r,n){var t=r,o=n;"function"==typeof t&&(o=t,t=void 0),function e(r,n,t){if(0===r.length)return o(null,void 0,t);var l=n+r[0],u=t;u?s(null,u):j(ae.dirname(l),s);function s(t,s,c){if(u=s,t)return o(t);if(c&&u&&i.pathFilter){var d=ae.relative(c,l),v=d.slice(0,d.length-r[0].length),h=i.pathFilter(u,n,v);if(h)return e([""].concat(p.slice()),ae.resolve(c,h),u)}a(l,f)}function f(t,i){return t?o(t):i?o(null,l,u):void e(r.slice(1),n,u)}}([""].concat(p),e,t)}function j(e,r){return""===e||"/"===e||"win32"===re.platform&&/^\w:[/\\]*$/.test(e)||/[/\\]node_modules[/\\]*$/.test(e)?r(null):void ge(s,e,i,(function(n,t){if(n)return j(ae.dirname(e),r);var o=ae.join(t,"package.json");a(o,(function(n,t){if(!t)return j(ae.dirname(e),r);f(u,o,(function(n,t){n&&r(n);var a=t;a&&i.packageFilter&&(a=i.packageFilter(a,o)),r(null,a,e)}))}))}))}function O(e,r,n){var t=n,o=r;"function"==typeof o&&(t=o,o=i.package),ge(s,e,i,(function(r,n){if(r)return t(r);var l=ae.join(n,"package.json");a(l,(function(r,n){return r?t(r):n?void f(u,l,(function(r,n){if(r)return t(r);var o=n;if(o&&i.packageFilter&&(o=i.packageFilter(o,l)),o&&o.main){if("string"!=typeof o.main){var a=new TypeError("package “"+o.name+"” `main` must be a string");return a.code="INVALID_PACKAGE_MAIN",t(a)}return"."!==o.main&&"./"!==o.main||(o.main="index"),void w(ae.resolve(e,o.main),o,(function(r,n,i){return r?t(r):n?t(null,n,i):i?void O(ae.resolve(e,i.main),i,(function(r,n,i){return r?t(r):n?t(null,n,i):void w(ae.join(e,"index"),i,t)})):w(ae.join(e,"index"),i,t)}))}w(ae.join(e,"/index"),o,t)})):w(ae.join(e,"index"),o,t)}))}))}function T(e,r){if(0===r.length)return e(null,void 0);var n=r[0];function t(r,t,a){return r?e(r):t?e(null,t,a):void O(n,i.package,o)}function o(n,t,i){return n?e(n):t?e(null,t,i):void T(e,r.slice(1))}l(ae.dirname(n),(function(o,a){if(o)return e(o);if(!a)return T(e,r.slice(1));w(n,i.package,t)}))}ge(s,y,i,(function(r,n){r?t(r):function(r){if(/^(?:\.\.?(?:\/|$)|\/|([A-Za-z]:)?[/\\])/.test(e))m=ae.resolve(r,e),"."!==e&&".."!==e&&"/"!==e.slice(-1)||(m+="/"),/\/$/.test(e)&&m===r?O(m,i.package,b):w(m,i.package,b);else{if(v&&fe(e))return t(null,e);!function(e,r,n){var t=function(){return function(e,r,n){for(var t=ue(r,n,e),i=0;i<t.length;i++)t[i]=ae.join(t[i],e);return t}(e,r,i)};T(n,d?d(e,r,t,i):t())}(e,r,(function(r,n,o){if(r)t(r);else{if(n)return ge(s,n,i,(function(e,r){e?t(e):t(null,r,o)}));var a=new Error("Cannot find module '"+e+"' from '"+g+"'");a.code="MODULE_NOT_FOUND",t(a)}}))}}(n)}))};var ye=n(Object.freeze({__proto__:null})),be=re.versions&&re.versions.node&&re.versions.node.split(".")||[];function we(e){for(var r=e.split(" "),n=r.length>1?r[0]:"=",t=(r.length>1?r[1]:r[0]).split("."),i=0;i<3;++i){var o=parseInt(be[i]||0,10),a=parseInt(t[i]||0,10);if(o!==a)return"<"===n?o<a:">="===n&&o>=a}return">="===n}function je(e){var r=e.split(/ ?&& ?/);if(0===r.length)return!1;for(var n=0;n<r.length;++n)if(!we(r[n]))return!1;return!0}function Oe(e){if("boolean"==typeof e)return e;if(e&&"object"==typeof e){for(var r=0;r<e.length;++r)if(je(e[r]))return!0;return!1}return je(e)}var Te=require("./core.json"),_e={};for(var Ne in Te)Object.prototype.hasOwnProperty.call(Te,Ne)&&(_e[Ne]=Oe(Te[Ne]));module.exports=_e;var ke=n(Object.freeze({__proto__:null})),Ee=require("has");function Fe(e,r){for(var n=e.split("."),t=r.split(" "),i=t.length>1?t[0]:"=",o=(t.length>1?t[1]:t[0]).split("."),a=0;a<3;++a){var l=parseInt(n[a]||0,10),u=parseInt(o[a]||0,10);if(l!==u)return"<"===i?l<u:">="===i&&l>=u}return">="===i}function Se(e,r){var n=r.split(/ ?&& ?/);if(0===n.length)return!1;for(var t=0;t<n.length;++t)if(!Fe(e,n[t]))return!1;return!0}var xe=require("./core.json");module.exports=function(e,r){return Ee(xe,e)&&function(e,r){if("boolean"==typeof r)return r;var n=void 0===e?re.versions&&re.versions.node:e;if("string"!=typeof n)throw new TypeError(void 0===e?"Unable to determine current node version":"If provided, a valid node version is required");if(r&&"object"==typeof r){for(var t=0;t<r.length;++t)if(Se(n,r[t]))return!0;return!1}return Se(n,r)}(r,xe[e])};var qe=n(Object.freeze({__proto__:null})),De=require("is-core-module"),Ae=require("fs"),Ie=require("path"),Pe=require("./homedir"),Me=require("./caller"),Je=require("./node-modules-paths"),ze=require("./normalize-options"),Ce=Ae.realpathSync&&"function"==typeof Ae.realpathSync.native?Ae.realpathSync.native:Ae.realpathSync,Le=Pe(),Re=function(e){try{var r=Ae.statSync(e,{throwIfNoEntry:!1})}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return!1;throw e}return!!r&&(r.isFile()||r.isFIFO())},Ue=function(e){try{var r=Ae.statSync(e,{throwIfNoEntry:!1})}catch(e){if(e&&("ENOENT"===e.code||"ENOTDIR"===e.code))return!1;throw e}return!!r&&r.isDirectory()},$e=function(e){try{return Ce(e)}catch(e){if("ENOENT"!==e.code)throw e}return e},Ve=function(e,r,n){return n&&!1===n.preserveSymlinks?e(r):r},Ge=function(e,r){var n=e(r);try{return JSON.parse(n)}catch(e){}};module.exports=function(e,r){if("string"!=typeof e)throw new TypeError("Path must be a string.");var n=ze(e,r),t=n.isFile||Re,i=n.readFileSync||Ae.readFileSync,o=n.isDirectory||Ue,a=n.realpathSync||$e,l=n.readPackageSync||Ge;if(n.readFileSync&&n.readPackageSync)throw new TypeError("`readFileSync` and `readPackageSync` are mutually exclusive.");var u=n.packageIterator,s=n.extensions||[".js"],f=!1!==n.includeCoreModules,c=n.basedir||Ie.dirname(Me()),d=n.filename||c;n.paths=n.paths||[Ie.join(Le,".node_modules"),Ie.join(Le,".node_libraries")];var p=Ve(a,Ie.resolve(c),n);if(/^(?:\.\.?(?:\/|$)|\/|([A-Za-z]:)?[/\\])/.test(e)){var v=Ie.resolve(p,e);"."!==e&&".."!==e&&"/"!==e.slice(-1)||(v+="/");var h=y(v)||w(v);if(h)return Ve(a,h,n)}else{if(f&&De(e))return e;var g=function(e,r){for(var t=function(){return function(e,r,n){for(var t=Je(r,n,e),i=0;i<t.length;i++)t[i]=Ie.join(t[i],e);return t}(e,r,n)},i=u?u(e,r,t,n):t(),a=0;a<i.length;a++){var l=i[a];if(o(Ie.dirname(l))){var s=y(l);if(s)return s;var f=w(l);if(f)return f}}}(e,p);if(g)return Ve(a,g,n)}var m=new Error("Cannot find module '"+e+"' from '"+d+"'");throw m.code="MODULE_NOT_FOUND",m;function y(e){var r=b(Ie.dirname(e));if(r&&r.dir&&r.pkg&&n.pathFilter){var i=Ie.relative(r.dir,e),o=n.pathFilter(r.pkg,e,i);o&&(e=Ie.resolve(r.dir,o))}if(t(e))return e;for(var a=0;a<s.length;a++){var l=e+s[a];if(t(l))return l}}function b(e){if(""!==e&&"/"!==e&&!("win32"===re.platform&&/^\w:[/\\]*$/.test(e)||/[/\\]node_modules[/\\]*$/.test(e))){var r=Ie.join(Ve(a,e,n),"package.json");if(!t(r))return b(Ie.dirname(e));var o=l(i,r);return o&&n.packageFilter&&(o=n.packageFilter(o,e)),{pkg:o,dir:e}}}function w(e){var r=Ie.join(Ve(a,e,n),"/package.json");if(t(r)){try{var o=l(i,r)}catch(e){}if(o&&n.packageFilter&&(o=n.packageFilter(o,e)),o&&o.main){if("string"!=typeof o.main){var u=new TypeError("package “"+o.name+"” `main` must be a string");throw u.code="INVALID_PACKAGE_MAIN",u}"."!==o.main&&"./"!==o.main||(o.main="index");try{var s=y(Ie.resolve(e,o.main));if(s)return s;var f=w(Ie.resolve(e,o.main));if(f)return f}catch(e){}}}return y(Ie.join(e,"/index"))}};var Ke=n(Object.freeze({__proto__:null})),Ze=ye;Ze.core=ke,Ze.isCore=function(e){return qe(e)},Ze.sync=Ke;var Be=Ze;var He=function(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)},Qe=Object.keys;var We=function(e){var r,n;for(r={},n=0;n<e.length;n++)r[e[n]]=!0;return Qe(r)},Xe=He,Ye=Object.prototype.hasOwnProperty;var er=function(e,r){return Xe(r)?Ye.call(r,"basedir")&&(e.basedir=r.basedir,"string"!=typeof e.basedir)?new TypeError("invalid option. `basedir` option must be a primitive string. Option: `"+e.basedir+"`."):Ye.call(r,"paths")&&(e.paths=r.paths,"string"!=typeof e.paths)?new TypeError("invalid option. `paths` option must be a primitive string. Option: `"+e.paths+"`."):null:new TypeError("invalid argument. Options argument must be an object. Value: `"+r+"`.")},rr={filename:"manifest.json",basedir:"",paths:""},nr=y,tr=ne.cwd,ir=te,or=Be.sync,ar=e.sync,lr=r,ur=He,sr=We,fr=er,cr=rr,dr=ir("library-manifest:main"),pr=Object.prototype.hasOwnProperty,vr=Object.keys;var hr=function e(r,n,i){var o,a,l,u,s,f,c,d,p,v,h,g,m,y,b,w;if("string"!=typeof r)throw new TypeError("invalid argument. First argument must be a string. Value: `"+r+"`.");if(f=JSON.parse(JSON.stringify(cr)),arguments.length>2){if(h=fr(f,i))throw h;f.basedir=nr.resolve(tr(),f.basedir)}else f.basedir=tr();if(dr("Options: %s",JSON.stringify(f)),r=nr.resolve(f.basedir,r),g=nr.dirname(r),dr("Manifest file path: %s",r),s=t(r),s=JSON.parse(JSON.stringify(s)),dr("Manifest: %s",JSON.stringify(s)),!ur(n))throw new TypeError("invalid argument. Second argument must be an object. Value: `"+n+"`.");for(dr("Provided conditions: %s",JSON.stringify(n)),o=vr(s.options),y=0;y<o.length;y++)p=o[y],pr.call(n,p)&&(s.options[p]=n[p]);for(dr("Conditions for matching a configuration: %s",JSON.stringify(s.options)),dr("Resolving matching configuration."),y=0;y<s.confs.length;y++){for(m=s.confs[y],b=0;b<o.length&&(p=o[b],pr.call(m,p)&&m[p]===s.options[p]);b++);if(b===o.length){d=JSON.parse(JSON.stringify(m)),dr("Matching configuration: %s",JSON.stringify(d));break}}if(void 0===d)return dr("Unable to resolve a matching configuration."),{};for(y=0;y<s.fields.length;y++)if(p=s.fields[y].field,pr.call(d,p)&&(m=d[p],s.fields[y].resolve))for(b=0;b<m.length;b++)m[b]=nr.resolve(g,m[b]);for(c=d.dependencies,dr("Resolving %d dependencies.",c.length),l={basedir:f.basedir},y=0;y<c.length;y++){for(dr("Resolving dependency: %s",c[y]),a=or(c[y],l),dr("Dependency entry point: %s",a),a=ar("package.json",{dir:nr.dirname(a)}),a=nr.dirname(a),dr("Dependency path: %s",a),u={basedir:a},m=e(nr.join(a,f.filename),n,u),dr("Dependency manifest: %s",JSON.stringify(m)),dr("Merging dependency manifest."),b=0;b<s.fields.length;b++)if(p=s.fields[b].field,pr.call(m,p)){if(v=m[p],s.fields[b].resolve)for(w=0;w<v.length;w++)v[w]=nr.resolve(a,v[w]);d[p]=d[p].concat(v)}dr("Resolved dependency: %s",c[y])}for(dr("Removing duplicate entries."),y=0;y<s.fields.length;y++)p=s.fields[y].field,pr.call(d,p)&&(d[p]=sr(d[p]));for(dr("Generating relative paths."),y=0;y<s.fields.length;y++)if(p=s.fields[y].field,pr.call(d,p)&&s.fields[y].resolve&&s.fields[y].relative)for(v=d[p],b=0;b<v.length;b++)v[b]=nr.relative(g,v[b]);if(f.paths)for(dr("Converting paths to specified convention."),y=0;y<s.fields.length;y++)if(p=s.fields[y].field,pr.call(d,p))for(v=d[p],b=0;b<v.length;b++)v[b]=lr(v[b],f.paths);return dr("Final configuration: %s",JSON.stringify(d)),d},gr=hr;export{gr as default};
//# sourceMappingURL=index.mjs.map
